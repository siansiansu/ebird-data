<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBird Species Search</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üê¶ eBird Species Search</h1>
            <p>Search for bird species in multiple languages</p>
        </header>

        <div class="search-section">
            <div class="search-container">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="Enter bird name, scientific name, or alternative name..."
                    autocomplete="off"
                >
                <button id="searchButton" class="search-button">Search</button>
                <button id="clearButton" class="clear-button">Clear</button>
            </div>
            <div class="stats">
                <span id="resultCount">Enter a search term to find bird species</span>
                <span id="loadTime"></span>
            </div>
        </div>

        <div id="loadingIndicator" class="loading" style="display: none;">
            Loading species data...
        </div>

        <div id="errorMessage" class="error" style="display: none;"></div>

        <div id="resultsContainer" class="results-container" style="display: none;">
        </div>

        <div id="noResults" class="no-results" style="display: none;">
            <p>No bird species found matching your search.</p>
            <p>Try different keywords or check your spelling.</p>
        </div>
    </div>

    <script>
        let speciesData = [];
        let isLoading = false;

        // Language code mappings
        const languageNames = {
            'comName': 'English',
            'comNameCs': 'ƒåe≈°tina',
            'comNameDe': 'Deutsch', 
            'comNameEsLA': 'Espa√±ol (LA)',
            'comNameEsES': 'Espa√±ol (ES)',
            'comNameEu': 'Euskera',
            'comNameFr': 'Fran√ßais',
            'comNameIt': 'Italiano',
            'comNameIw': '◊¢◊ë◊®◊ô◊™',
            'comNameJp': 'Êó•Êú¨Ë™û',
            'comNameMn': '–ú–æ–Ω–≥–æ–ª',
            'comNameNo': 'Norsk',
            'comNamePtPT': 'Portugu√™s (PT)',
            'comNamePtBR': 'Portugu√™s (BR)',
            'comNameRu': '–†—É—Å—Å–∫–∏–π',
            'comNameTr': 'T√ºrk√ße',
            'comNameUk': '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞',
            'comNameZh': '‰∏≠Êñá(ÁπÅ)',
            'comNameZhCN': '‰∏≠Êñá(ÁÆÄ)'
        };

        // Load species data
        async function loadSpeciesData() {
            if (isLoading || speciesData.length > 0) return;
            
            isLoading = true;
            const loadingIndicator = document.getElementById('loadingIndicator');
            loadingIndicator.style.display = 'block';

            try {
                const response = await fetch('./species.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                speciesData = await response.json();
                console.log(`Loaded ${speciesData.length} species`);
            } catch (error) {
                console.error('Error loading species data:', error);
                showError('Failed to load species data. Please try again later.');
            } finally {
                isLoading = false;
                loadingIndicator.style.display = 'none';
            }
        }

        // Search function
        function searchSpecies(query) {
            if (!query.trim()) {
                showResults([]);
                return;
            }

            const startTime = performance.now();
            const searchTerm = query.toLowerCase().trim();
            
            const results = speciesData.filter(species => {
                // Search in scientific name
                if (species.sciName && species.sciName.toLowerCase().includes(searchTerm)) {
                    return true;
                }

                // Search in all language names
                for (const field in languageNames) {
                    if (species[field] && species[field].toLowerCase().includes(searchTerm)) {
                        return true;
                    }
                }

                // Search in alternative names
                if (species.comNameList && species.comNameList.length > 0) {
                    return species.comNameList.some(name => 
                        name.toLowerCase().includes(searchTerm)
                    );
                }

                return false;
            });

            const endTime = performance.now();
            const loadTime = Math.round(endTime - startTime);
            
            showResults(results, loadTime);
        }

        // Show results
        function showResults(results, loadTime = 0) {
            const resultsContainer = document.getElementById('resultsContainer');
            const noResults = document.getElementById('noResults');
            const resultCount = document.getElementById('resultCount');
            const loadTimeSpan = document.getElementById('loadTime');

            // Update stats
            if (results.length === 0 && document.getElementById('searchInput').value.trim()) {
                resultCount.textContent = 'No results found';
                noResults.style.display = 'block';
                resultsContainer.style.display = 'none';
            } else if (results.length === 0) {
                resultCount.textContent = 'Enter a search term to find bird species';
                noResults.style.display = 'none';
                resultsContainer.style.display = 'none';
            } else {
                resultCount.textContent = `Found ${results.length} species`;
                noResults.style.display = 'none';
                resultsContainer.style.display = 'block';
            }

            if (loadTime > 0) {
                loadTimeSpan.textContent = `(${loadTime}ms)`;
            } else {
                loadTimeSpan.textContent = '';
            }

            // Clear previous results
            resultsContainer.innerHTML = '';

            // Show results
            results.forEach(species => {
                const card = createSpeciesCard(species);
                resultsContainer.appendChild(card);
            });
        }

        // Create species card
        function createSpeciesCard(species) {
            const card = document.createElement('div');
            card.className = 'result-card';

            const speciesName = document.createElement('h3');
            speciesName.className = 'species-name';
            speciesName.textContent = species.comName || 'Unknown';

            const scientificName = document.createElement('p');
            scientificName.className = 'scientific-name';
            scientificName.textContent = species.sciName || '';

            const languagesGrid = document.createElement('div');
            languagesGrid.className = 'languages-grid';

            // Add all language names
            Object.entries(languageNames).forEach(([field, langName]) => {
                if (species[field] && species[field] !== species.comName) {
                    const languageItem = document.createElement('div');
                    languageItem.className = 'language-item';

                    const languageCode = document.createElement('span');
                    languageCode.className = 'language-code';
                    languageCode.textContent = field.replace('comName', '').toLowerCase() || 'en';

                    const languageName = document.createElement('span');
                    languageName.className = 'language-name';
                    languageName.textContent = species[field];

                    languageItem.appendChild(languageCode);
                    languageItem.appendChild(languageName);
                    languagesGrid.appendChild(languageItem);
                }
            });

            card.appendChild(speciesName);
            card.appendChild(scientificName);
            card.appendChild(languagesGrid);

            // Add alternative names if available
            if (species.comNameList && species.comNameList.length > 0) {
                const alternativeNames = document.createElement('div');
                alternativeNames.className = 'alternative-names';

                const label = document.createElement('div');
                label.className = 'alternative-names-label';
                label.textContent = 'Alternative names:';

                const namesList = document.createElement('div');
                namesList.className = 'alternative-names-list';

                species.comNameList.forEach(name => {
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'alternative-name';
                    nameSpan.textContent = name;
                    namesList.appendChild(nameSpan);
                });

                alternativeNames.appendChild(label);
                alternativeNames.appendChild(namesList);
                card.appendChild(alternativeNames);
            }

            return card;
        }

        // Show error message
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const clearButton = document.getElementById('clearButton');

            // Load data when page loads
            loadSpeciesData();

            // Search on input
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    if (speciesData.length > 0) {
                        searchSpecies(e.target.value);
                    }
                }, 300);
            });

            // Search on button click
            searchButton.addEventListener('click', () => {
                if (speciesData.length > 0) {
                    searchSpecies(searchInput.value);
                } else {
                    loadSpeciesData().then(() => {
                        searchSpecies(searchInput.value);
                    });
                }
            });

            // Clear search
            clearButton.addEventListener('click', () => {
                searchInput.value = '';
                showResults([]);
            });

            // Search on Enter
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    if (speciesData.length > 0) {
                        searchSpecies(searchInput.value);
                    } else {
                        loadSpeciesData().then(() => {
                            searchSpecies(searchInput.value);
                        });
                    }
                }
            });
        });
    </script>
</body>
</html>